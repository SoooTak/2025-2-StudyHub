<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ìŠ¤í„°ë”” ëª©ë¡ - StudyHub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ğŸ”¹ ê³µí†µ í…Œë§ˆ CSS -->
    <link rel="stylesheet" th:href="@{/css/studyhub.css}">

    <!-- ğŸ”¹ ì´ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ (body/header ê±´ë“œë¦¬ì§€ ì•ŠìŒ) -->
    <style>
        .studies-main {
            max-width: 960px;
            margin: 0 auto;
        }

        .studies-main h1 {
            margin-top: 0;
            font-size: 24px;
        }

        .subtitle {
            margin-top: 4px;
            margin-bottom: 16px;
            font-size: 14px;
            color: var(--color-text-muted);
        }

        .actions {
            margin: 8px 0 16px 0;
            text-align: right;
        }

        /* ê²€ìƒ‰/í•„í„° ì˜ì—­ */
        .search-filter {
            margin: 12px 0 20px 0;
            padding: 12px 14px;
            border-radius: 10px;
            background-color: var(--color-primary-soft);
            border: 1px solid var(--color-border-subtle);
        }

        .search-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .form-field {
            flex: 1 1 200px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 0;
        }

        .form-field label {
            font-size: 12px;
            color: var(--color-text-muted);
        }

        .form-field input[type="text"],
        .form-field select {
            padding: 6px 8px;
            border-radius: 8px;
            border: 1px solid #cbd5f5;
            font-size: 13px;
        }

        .form-field input[type="text"]:focus,
        .form-field select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.15);
        }

        .search-actions {
            margin-top: 10px;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        .search-actions .btn-secondary {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 13px;
        }

        .study-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .study-card {
            border-radius: 10px;
            border: 1px solid #e0e4f0;
            padding: 14px 16px;
        }

        .study-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .study-card h2 {
            margin: 0;
            font-size: 18px;
        }

        .study-card p {
            margin: 4px 0;
            color: #555;
            font-size: 14px;
        }

        .meta {
            margin-top: 6px;
            font-size: 12px;
            color: #777;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .detail-link {
            margin-top: 8px;
            font-size: 13px;
            display: inline-block;
            color: var(--color-primary);
            text-decoration: none;
        }

        .detail-link:hover {
            text-decoration: underline;
        }

        .empty {
            color: #777;
            font-size: 14px;
            margin-top: 12px;
        }

        /* ì°¸ì—¬ ìƒíƒœ ë±ƒì§€ */
        .status-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 3px 10px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 500;
            border: 1px solid transparent;
            white-space: nowrap;
        }

        .status-joined {
            background-color: #e0f2fe;
            border-color: #38bdf8;
            color: #0369a1;
        }

        .status-pending {
            background-color: #fef9c3;
            border-color: #facc15;
            color: #854d0e;
        }

        .status-available {
            background-color: #ecfdf3;
            border-color: #22c55e;
            color: #166534;
        }

        .card-footer {
            margin-top: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            flex-wrap: wrap;
        }

        .card-footer-left {
            font-size: 12px;
            color: #999;
        }

        .card-footer-right {
            text-align: right;
        }

        .card-footer-right .detail-link {
            margin-top: 0;
        }

        @media (max-width: 600px) {
            .search-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- ğŸ”¹ ê³µí†µ í—¤ë” (í°ìƒ‰ topbar) -->
    <th:block th:replace="fragments/header :: header"></th:block>

    <!-- ğŸ”¹ ê³µí†µ ë°°ê²½/ì—¬ë°±: page-container / card í™œìš© -->
    <main class="page-container">
        <section class="card studies-main">
            <h1>ê³µê°œ ìŠ¤í„°ë”” ë‘˜ëŸ¬ë³´ê¸°</h1>
            <p class="subtitle">
                ëˆ„êµ¬ë‚˜ ì‹ ì²­í•  ìˆ˜ ìˆëŠ” ê³µê°œ ìŠ¤í„°ë””ì…ë‹ˆë‹¤. ê²€ìƒ‰ê³¼ í•„í„°ë¥¼ ì´ìš©í•´ ì›í•˜ëŠ” ìŠ¤í„°ë””ë¥¼ ì°¾ì•„ë³´ì„¸ìš”.
            </p>

            <!-- ê²€ìƒ‰/í•„í„° í¼ -->
            <form th:action="@{/studies}" method="get" class="search-filter">
                <div class="search-row">
                    <div class="form-field">
                        <label for="keyword">ê²€ìƒ‰ì–´ (ì œëª© / ì†Œê°œ)</label>
                        <input type="text"
                               id="keyword"
                               name="keyword"
                               placeholder="ì˜ˆ: ìë°”, í† ìµ, ì•Œê³ ë¦¬ì¦˜"
                               th:value="${keyword}">
                    </div>
                    <div class="form-field">
                        <label for="category">ì¹´í…Œê³ ë¦¬</label>
                        <input type="text"
                               id="category"
                               name="category"
                               placeholder="ì˜ˆ: í”„ë¡œê·¸ë˜ë°, ì–´í•™"
                               th:value="${category}">
                    </div>
                    <div class="form-field">
                        <label for="sort">ì •ë ¬</label>
                        <select id="sort" name="sort" th:value="${sort}">
                            <option value="latest">ìµœì‹ ìˆœ</option>
                            <option value="oldest">ì˜¤ë˜ëœìˆœ</option>
                            <option value="title">ì œëª©ìˆœ</option>
                        </select>
                    </div>
                </div>
                <div class="search-actions">
                    <button type="submit" class="btn-primary">ê²€ìƒ‰</button>
                    <a th:href="@{/studies}" class="btn-secondary">ì´ˆê¸°í™”</a>
                </div>
            </form>

            <div class="actions">
                <a href="/my/studies/new" class="btn-primary">ìŠ¤í„°ë”” ê°œì„¤í•˜ê¸°</a>
            </div>

            <div class="study-list">
                <div th:if="${#lists.isEmpty(studies)}" class="empty">
                    í˜„ì¬ ì¡°ê±´ì— ë§ëŠ” ìŠ¤í„°ë””ê°€ ì—†ìŠµë‹ˆë‹¤. ê²€ìƒ‰ ì¡°ê±´ì„ ë°”ê¾¸ê±°ë‚˜, ì²« ë²ˆì§¸ ìŠ¤í„°ë””ë¥¼ ê°œì„¤í•´ ë³´ì„¸ìš”!
                </div>

                <div th:each="study : ${studies}" class="study-card">
                    <div class="study-card-header">
                        <h2 th:text="${study.title}">ìŠ¤í„°ë”” ì œëª©</h2>

                        <!-- ë¡œê·¸ì¸í•œ ê²½ìš°ì—ë§Œ ì°¸ì—¬ ìƒíƒœ ë±ƒì§€ í‘œì‹œ -->
                        <div th:if="${loggedIn}">
                            <span th:switch="${joinStatusMap[study.id]}"
                                  class="status-badge"
                                  th:classappend="' ' +
                                      (${joinStatusMap[study.id]} == 'JOINED' ? 'status-joined' :
                                       (${joinStatusMap[study.id]} == 'PENDING' ? 'status-pending' : 'status-available'))">
                                <span th:case="'JOINED'">ì°¸ì—¬ì¤‘</span>
                                <span th:case="'PENDING'">ê°€ì… ëŒ€ê¸°ì¤‘</span>
                                <span th:case="*">ì‹ ì²­ ê°€ëŠ¥</span>
                            </span>
                        </div>
                    </div>

                    <p th:text="${study.description}">ìŠ¤í„°ë”” ì†Œê°œ</p>

                    <div class="meta">
                        <span th:text="'ì¹´í…Œê³ ë¦¬: ' + (${study.category} ?: 'ë¯¸ì§€ì •')">ì¹´í…Œê³ ë¦¬</span>
                        <span th:text="'ëª¨ì§‘ ì¸ì›: ' + ${study.maxMembers} + 'ëª…'">ëª¨ì§‘ ì¸ì›</span>
                        <span th:text="'ëª¨ì„ ë°©ì‹: ' + (${study.studyMode} ?: 'ë¯¸ì§€ì •')">ëª¨ì„ ë°©ì‹</span>
                        <span th:text="'ì¥ì†Œ: ' + (${study.location} ?: 'ë¯¸ì§€ì •')">ì¥ì†Œ</span>
                    </div>

                    <div class="card-footer">
                        <div class="card-footer-left">
                            <!-- í•„ìš”í•˜ë©´ createdAt ë“± ìš”ì•½ í‘œì‹œ ê°€ëŠ¥ -->
                        </div>
                        <div class="card-footer-right">
                            <a th:href="@{'/studies/' + ${study.id}}" class="detail-link">ìì„¸íˆ ë³´ê¸°</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
</body>
</html>

<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${study.title} + ' - StudyHub'">스터디 상세 - StudyHub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- 전역 화이트 테마 -->
    <link rel="stylesheet" th:href="@{/css/studyhub.css}">

    <style>
        .detail-layout {
            display: grid;
            grid-template-columns: minmax(0, 2fr) minmax(0, 1.4fr);
            gap: 16px;
            align-items: flex-start;
        }

        .detail-meta {
            margin-top: 6px;
            font-size: 13px;
            color: var(--color-text-muted);
            display: flex;
            flex-wrap: wrap;
            gap: 8px 16px;
        }

        .badge-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 999px;
            background-color: var(--color-primary-soft);
            color: var(--color-primary);
            font-size: 12px;
        }

        .desc-block {
            margin-top: 10px;
            font-size: 14px;
            color: var(--color-text-main);
            white-space: pre-wrap;
        }

        .sub-title {
            margin-top: 16px;
            font-size: 15px;
            font-weight: 600;
        }

        .status-box-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .status-text {
            font-size: 14px;
            color: var(--color-text-main);
        }

        .btn-group {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .back-link {
            display: inline-block;
            margin-top: 16px;
            font-size: 13px;
            color: var(--color-primary);
            text-decoration: none;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        @media (max-width: 840px) {
            .detail-layout {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<!-- 사이트 공통 헤더 -->
<th:block th:replace="fragments/header :: header"></th:block>

<main class="page-container">

    <section class="card">
        <div class="detail-layout">
            <!-- 왼쪽: 스터디 정보 -->
            <div>
                <h1 class="section-title" th:text="${study.title}">스터디 제목</h1>

                <div class="detail-meta">
                    <span th:text="'카테고리: ' + (${study.category} ?: '미지정')">카테고리</span>
                    <span th:text="'모집 인원: ' + ${study.maxMembers} + '명'">모집 인원</span>
                    <span th:text="'공개 여부: ' + (${study.public} ? '공개' : '비공개')">공개 여부</span>
                    <span th:text="'진행 방식: ' + (${study.studyMode} ?: '미지정')">진행 방식</span>
                </div>

                <div class="sub-title">스터디 소개</div>
                <div class="desc-block" th:text="${study.description}">
                    스터디 소개 텍스트
                </div>

                <div class="sub-title">진행 방식 / 장소</div>
                <div class="desc-block">
                    <div th:text="'진행 방식: ' + (${study.studyMode} ?: '미지정')">진행 방식</div>
                    <div th:text="'오프라인 장소: ' + (${study.location} ?: '미정')">장소</div>
                </div>
            </div>

            <!-- 오른쪽: 가입 상태 카드 -->
            <div>
                <div class="card" style="padding:16px 18px;">
                    <div class="status-box-title">가입 상태</div>

                    <!-- 비로그인 -->
                    <div th:if="${!loggedIn}" class="status-text">
                        로그인 후 가입 신청을 할 수 있습니다.
                        <div class="btn-group">
                            <a href="/login" class="btn-primary">로그인 하러 가기</a>
                        </div>
                    </div>

                    <!-- 로그인 상태 -->
                    <div th:if="${loggedIn}">
                        <!-- 이미 멤버인 경우 -->
                        <div th:if="${isMember}" class="status-text">
                            이미 이 스터디의 구성원입니다.
                            <div class="btn-group">
                                <a th:href="@{'/room/' + ${study.id}}" class="btn-primary">
                                    스터디 홈으로 이동
                                </a>
                                <a th:href="@{'/my/studies'}" class="btn-secondary">
                                    내 스터디 목록
                                </a>
                            </div>
                        </div>

                        <!-- 멤버는 아니지만, 리더인 경우 -->
                        <div th:if="${!isMember and (study.leader != null and study.leader.email == loginEmail)}"
                             class="status-text">
                            이 스터디의 리더(개설자)입니다.
                            <div class="btn-group">
                                <a th:href="@{'/room/' + ${study.id}}" class="btn-primary">
                                    스터디 홈으로 이동
                                </a>
                                <a th:href="@{'/my/studies'}" class="btn-secondary">
                                    내 스터디 관리
                                </a>
                            </div>
                        </div>

                        <!-- 멤버도 아니고 리더도 아닌 경우 -->
                        <div th:if="${!isMember and not (study.leader != null and study.leader.email == loginEmail)}"
                             class="status-text">

                            <div th:if="${hasPendingApplication}">
                                이미 가입 신청을 제출하여 <b>승인 대기 중</b>입니다.
                            </div>

                            <div th:if="${!hasPendingApplication}">
                                아직 이 스터디에 가입 신청을 하지 않았습니다.
                                <div class="btn-group">
                                    <a th:href="@{'/my/studies/' + ${study.id} + '/apply'}"
                                       class="btn-primary">
                                        이 스터디에 가입 신청하기
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top:10px;">
                        <span class="badge-pill" th:if="${study.leader != null}">
                            리더 · <span th:text="${study.leader.nickname != null ? study.leader.nickname : study.leader.email}">
                                leader
                            </span>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <a href="/studies" class="back-link">← 스터디 목록으로 돌아가기</a>
    </section>

</main>

</body>
</html>

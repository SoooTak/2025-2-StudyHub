<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${study.title} + ' - StudyHub'">스터디 상세 - StudyHub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fb;
        }

        header {
            background-color: #2b4cff;
            color: #ffffff;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .brand {
            font-size: 20px;
            font-weight: 600;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .nav-right span {
            margin-right: 4px;
        }

        .link-btn,
        .link-button {
            display: inline-block;
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid #ffffff;
            background: transparent;
            color: #ffffff;
            font-size: 13px;
            text-decoration: none;
            cursor: pointer;
        }

        .link-btn.secondary {
            border-color: #d0dcff;
            background-color: #ffffff;
            color: #2b4cff;
        }

        .link-btn:hover,
        .link-button:hover {
            opacity: 0.9;
        }

        .link-button {
            border: 1px solid #ffffff;
        }

        main {
            max-width: 960px;
            margin: 32px auto;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            padding: 24px 28px;
        }

        h1 {
            margin-top: 0;
            font-size: 24px;
        }

        .meta {
            margin-top: 8px;
            font-size: 13px;
            color: #777;
        }

        .meta span {
            margin-right: 12px;
        }

        .section-title {
            margin-top: 20px;
            font-size: 16px;
            font-weight: 600;
        }

        .desc {
            margin-top: 8px;
            font-size: 14px;
            color: #555;
            white-space: pre-wrap;
        }

        .status-box {
            margin-top: 24px;
            padding: 12px 14px;
            border-radius: 10px;
            background-color: #f0f4ff;
            font-size: 14px;
            color: #234;
        }

        .status-box strong {
            display: block;
            margin-bottom: 4px;
        }

        .primary-btn {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 14px;
            border-radius: 999px;
            border: none;
            background-color: #2b4cff;
            color: #ffffff;
            font-size: 13px;
            font-weight: 600;
            text-decoration: none;
        }

        .primary-btn:hover {
            opacity: 0.9;
        }

        .back-link {
            display: inline-block;
            margin-top: 16px;
            font-size: 13px;
            color: #2b4cff;
            text-decoration: none;
        }

        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
<header>
    <div class="brand">
        <a href="/" style="color: #ffffff; text-decoration: none;">StudyHub</a>
    </div>
    <div class="nav-right">
        <a href="/studies" class="link-btn secondary">스터디 탐색</a>
        <a href="/my/studies" class="link-btn">내 스터디</a>

        <span th:if="${loggedIn}" th:text="${loginEmail} + ' 님'">user@example.com 님</span>
        <form th:if="${loggedIn}" th:action="@{/logout}" method="post" style="margin: 0;">
            <button type="submit" class="link-button">로그아웃</button>
        </form>

        <a th:if="${!loggedIn}" href="/login" class="link-btn">로그인</a>
        <a th:if="${!loggedIn}" href="/signup" class="link-btn secondary">회원가입</a>
    </div>
</header>
<main>
    <h1 th:text="${study.title}">스터디 제목</h1>

    <div class="meta">
        <span th:text="'카테고리: ' + (${study.category} ?: '미지정')">카테고리</span>
        <span th:text="'모집 인원: ' + ${study.maxMembers} + '명'">모집 인원</span>
        <span th:text="'공개 여부: ' + (${study.public} ? '공개' : '비공개')">공개 여부</span>
        <span th:text="'진행 방식: ' + (${study.studyMode} ?: '미지정')">진행 방식</span>
    </div>

    <div class="section-title">스터디 소개</div>
    <div class="desc" th:text="${study.description}">
        스터디 소개 텍스트
    </div>

    <div class="section-title">진행 방식 / 장소</div>
    <div class="desc">
        <div th:text="'진행 방식: ' + (${study.studyMode} ?: '미지정')">진행 방식</div>
        <div th:text="'오프라인 장소: ' + (${study.location} ?: '미정')">장소</div>
    </div>

    <div class="status-box">
        <strong>가입 상태</strong>

        <div th:if="${!loggedIn}">
            로그인 후 가입 신청을 할 수 있습니다.
            <a href="/login" class="primary-btn" style="margin-left: 0; margin-top: 8px;">로그인 하러 가기</a>
        </div>

        <div th:if="${loggedIn}">
            <!-- 이미 멤버인 경우 -->
            <div th:if="${isMember}">
                이미 이 스터디의 구성원입니다.
                <br>
                <a th:href="@{'/room/' + ${study.id}}" class="primary-btn" style="margin-top: 8px;">
                    스터디 홈으로 이동
                </a>
            </div>

            <!-- 멤버는 아니지만, 리더인 경우 (membership 없이도 접근 가능) -->
            <div th:if="${!isMember and (study.leader != null and study.leader.email == loginEmail)}">
                이 스터디의 리더(개설자)입니다.
                <br>
                <a th:href="@{'/room/' + ${study.id}}" class="primary-btn" style="margin-top: 8px;">
                    스터디 홈으로 이동
                </a>
            </div>

            <!-- 멤버도 아니고 리더도 아닌 경우 -->
            <div th:if="${!isMember and not (study.leader != null and study.leader.email == loginEmail)}">

                <div th:if="${hasPendingApplication}">
                    이미 가입 신청을 제출하여 승인 대기 중입니다.
                </div>

                <div th:if="${!hasPendingApplication}">
                    아직 가입 신청을 하지 않았습니다.
                    <br>
                    <a th:href="@{'/my/studies/' + ${study.id} + '/apply'}" class="primary-btn">
                        이 스터디에 가입 신청하기
                    </a>
                </div>
            </div>
        </div>
    </div>

    <a href="/studies" class="back-link">← 스터디 목록으로 돌아가기</a>
</main>
</body>
</html>

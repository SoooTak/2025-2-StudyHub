<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${study != null ? study.title + ' · StudyHub' : 'StudyHub'}">StudyHub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- 전역 화이트 테마 -->
  <link rel="stylesheet" th:href="@{/css/studyhub.css}">
  <style>
    /* 페이지 전용: 간단한 2열/1열 그리드 */
    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    .grid-4 {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 12px;
      margin-top: 12px;
    }
    .stat {
      background: var(--color-surface);
      border-radius: 16px;
      box-shadow: var(--shadow-card);
      padding: 16px;
    }
    .stat h4 {
      margin: 0 0 8px;
      font-size: 14px;
      color: var(--color-text-muted);
      font-weight: 600;
    }
    .stat .num {
      font-size: 22px;
      font-weight: 700;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: var(--color-primary-soft);
      color: var(--color-primary);
      font-size: 12px;
      margin-right: 6px;
    }
    .links {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    @media (max-width: 860px) {
      .grid { grid-template-columns: 1fr; }
      .grid-4 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 520px) {
      .grid-4 { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<!-- 사이트 공통 헤더 (화이트) -->
<th:block th:replace="fragments/header :: header"></th:block>

<!-- 스터디룸 상단 탭 (화이트 테마) -->
<header class="room-header">
  <div style="display:flex;align-items:center;gap:14px;">
    <a class="room-brand" th:href="@{|/room/${study.id}|}"
       th:text="${study != null ? study.title : '스터디'}">스터디</a>
    <nav class="room-nav">
      <a class="active" th:href="@{|/room/${study.id}|}">홈</a>
      <a th:href="@{|/room/${study.id}/sessions|}">출석</a>
      <a th:href="@{|/room/${study.id}/board|}">게시판</a>
      <a th:href="@{|/room/${study.id}/files|}">자료실</a>
      <a th:href="@{|/room/${study.id}/members|}">멤버</a>
    </nav>
  </div>
  <div class="room-header-right">
    <span class="role-badge" th:if="${myRole != null}" th:text="${myRole}">MEMBER</span>
    <a class="btn-secondary" th:href="@{/studies}">다른 스터디 둘러보기</a>
  </div>
</header>

<main class="page-container">

  <!-- 상단 요약 카드 -->
  <section class="card">
    <h2 class="section-title" th:text="${study != null ? study.title : '스터디'}">스터디</h2>
    <p class="muted" th:if="${study != null}" th:text="${study.description}">스터디 소개</p>

    <div style="margin-top:10px;">
      <span class="pill" th:if="${study != null && study.category != null}">
        카테고리 · <span th:text="${study.category}">ETC</span>
      </span>
      <span class="pill" th:if="${study != null && study.studyMode != null}">
        방식 · <span th:text="${study.studyMode}">ONLINE</span>
      </span>
      <span class="pill" th:if="${study != null && study.location != null}">
        지역 · <span th:text="${study.location}">Seoul</span>
      </span>
      <span class="pill" th:if="${study != null && study.maxMembers != null}">
        정원 · <span th:text="${study.maxMembers}">10</span>
      </span>
    </div>

    <div class="grid-4">
      <div class="stat">
        <h4>멤버 수</h4>
        <div class="num" th:text="${memberCount != null ? memberCount : '-'}">-</div>
      </div>
      <div class="stat">
        <h4>세션 수</h4>
        <div class="num" th:text="${sessionCount != null ? sessionCount : '-'}">-</div>
      </div>
      <div class="stat">
        <h4>내 출석률</h4>
        <div class="num" th:text="${myAttendanceRate != null ? myAttendanceRate + '%': '-'}">-</div>
      </div>
      <div class="stat">
        <h4>미확인 알림</h4>
        <div class="num" th:text="${unreadCount != null ? unreadCount : 0}">0</div>
      </div>
    </div>
  </section>

  <!-- 핵심 바로가기 카드 2열 -->
  <section class="grid">
    <div class="card">
      <h3 class="section-title">다음 세션</h3>
      <div th:if="${nextSession != null}">
        <p><b th:text="${nextSession.title}">주간 스터디</b></p>
        <p class="muted" th:text="${#temporals.format(nextSession.startAt, 'yyyy-MM-dd (E) HH:mm')}">2025-12-05 19:00</p>
        <div class="links" style="margin-top:8px;">
          <a class="btn-primary" th:href="@{|/room/${study.id}/sessions|}">출석 페이지</a>
          <a class="btn-secondary" th:href="@{|/room/${study.id}/sessions|}">세션 목록</a>
        </div>
      </div>
      <div th:if="${nextSession == null}">
        <p class="muted">예정된 세션이 없습니다.</p>
        <div class="links" style="margin-top:8px;">
          <a class="btn-secondary" th:href="@{|/room/${study.id}/sessions|}">세션 관리/목록</a>
        </div>
      </div>
    </div>

    <div class="card">
      <h3 class="section-title">최근 공지</h3>
      <div th:if="${recentNotice != null}">
        <p><b th:text="${recentNotice.title}">공지 제목</b></p>
        <p class="muted" th:text="${#temporals.format(recentNotice.createdAt, 'yyyy-MM-dd HH:mm')}">2025-12-04 09:00</p>
        <div class="links" style="margin-top:8px;">
          <a class="btn-primary" th:href="@{|/room/${study.id}/board|}">게시판 가기</a>
          <a class="btn-secondary" th:href="@{|/room/${study.id}/board|}">전체 보기</a>
        </div>
      </div>
      <div th:if="${recentNotice == null}">
        <p class="muted">아직 등록된 공지가 없습니다.</p>
        <div class="links" style="margin-top:8px;">
          <a class="btn-secondary" th:href="@{|/room/${study.id}/board|}">게시판 가기</a>
        </div>
      </div>
    </div>
  </section>

  <!-- 자료/멤버 바로가기 -->
  <section class="grid" style="margin-top:12px;">
    <div class="card">
      <h3 class="section-title">자료실</h3>
      <p class="muted">스터디 자료를 업로드하고 다운로드할 수 있습니다.</p>
      <div class="links" style="margin-top:8px;">
        <a class="btn-primary" th:href="@{|/room/${study.id}/files|}">자료실 이동</a>
        <a class="btn-secondary" th:href="@{|/room/${study.id}/files|}">최근 자료</a>
      </div>
    </div>

    <div class="card">
      <h3 class="section-title">멤버</h3>
      <p class="muted">현재 참여 중인 멤버 목록과 역할을 확인하세요.</p>
      <div class="links" style="margin-top:8px;">
        <a class="btn-primary" th:href="@{|/room/${study.id}/members|}">멤버 보기</a>
        <a class="btn-secondary" th:href="@{|/room/${study.id}/members|}">역할/권한</a>
      </div>
    </div>
  </section>

</main>

</body>
</html>

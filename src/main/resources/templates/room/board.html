<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${study.title} + ' - 게시판 - StudyHub'">게시판 - StudyHub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- 전역 화이트 테마 -->
    <link rel="stylesheet" th:href="@{/css/studyhub.css}">

    <!-- 이 페이지 전용 스타일 -->
    <style>
        * { box-sizing: border-box; }

        .board-main {
            max-width: 1040px;
            margin: 0 auto;
        }

        .meta {
            margin-top: 4px;
            font-size: 13px;
            color: var(--color-text-muted);
        }
        .meta span {
            margin-right: 12px;
        }

        .section-title {
            margin-top: 20px;
            font-size: 16px;
            font-weight: 600;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
            font-size: 13px;
        }
        thead {
            background-color: #eff6ff;
        }
        th, td {
            padding: 8px 10px;
            border-bottom: 1px solid var(--color-border-subtle);
            text-align: left;
        }
        th {
            font-weight: 600;
            color: var(--color-text-main);
        }
        tbody tr:nth-child(even) {
            background-color: #f9fafb;
        }
        .empty {
            padding: 8px 0;
            font-size: 13px;
            color: var(--color-text-muted);
        }

        .badge-notice {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 11px;
            background-color: #fff4e0;
            border: 1px solid #f0c27b;
            color: #b07219;
            margin-right: 6px;
        }

        .write-card {
            margin-top: 26px;
            padding-top: 18px;
            border-top: 1px dashed var(--color-border-subtle);
        }
        .write-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .form-row {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-bottom: 10px;
            font-size: 13px;
        }
        .form-row label {
            font-weight: 500;
        }
        .form-row input,
        .form-row textarea,
        .form-row select {
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #cfd5e8;
            font-size: 13px;
        }
        .form-row textarea {
            min-height: 120px;
            resize: vertical;
        }
        .form-row input:focus,
        .form-row textarea:focus,
        .form-row select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 1px rgba(37,99,235,0.12);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 6px 12px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 13px;
        }

        .back-link {
            display: inline-block;
            margin-top: 16px;
            font-size: 13px;
            color: var(--color-primary);
            text-decoration: none;
        }
        .back-link:hover {
            text-decoration: underline;
        }

        @media (max-width: 640px) {
            table {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>

<!-- 사이트 공통 헤더 -->
<th:block th:replace="fragments/header :: header"></th:block>

<!-- 스터디룸 상단 탭 (게시판 탭 활성화) -->
<header class="room-header">
    <div style="display:flex;align-items:center;gap:14px;">
        <a class="room-brand" th:href="@{|/room/${study.id}|}"
           th:text="${study != null ? study.title : '스터디'}">스터디</a>
        <nav class="room-nav">
            <a th:href="@{|/room/${study.id}|}">홈</a>
            <a th:href="@{|/room/${study.id}/sessions|}">출석</a>
            <a class="active" th:href="@{|/room/${study.id}/board|}">게시판</a>
            <a th:href="@{|/room/${study.id}/files|}">자료실</a>
            <a th:href="@{|/room/${study.id}/members|}">멤버</a>
        </nav>
    </div>
    <div class="room-header-right">
        <span class="role-badge" th:if="${myRole != null}" th:text="${myRole}">MEMBER</span>
        <a class="btn-secondary" th:href="@{/studies}">다른 스터디 둘러보기</a>
    </div>
</header>

<main class="page-container">
    <section class="card board-main">
        <h2 class="section-title" th:text="${study.title} + ' - 게시판'">게시판</h2>
        <div class="meta">
            <span th:text="'카테고리: ' + (${study.category} ?: '미지정')">카테고리</span>
            <span th:text="'진행 방식: ' + (${study.studyMode} ?: '미지정')">진행 방식</span>
        </div>

        <!-- 공지 목록 -->
        <div class="section-title">공지</div>
        <div th:if="${#lists.isEmpty(noticePosts)}" class="empty">
            등록된 공지가 없습니다.
        </div>
        <table th:if="${!#lists.isEmpty(noticePosts)}">
            <thead>
            <tr>
                <th>제목</th>
                <th>작성자</th>
                <th>작성일</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="postItem : ${noticePosts}">
                <td>
                    <a th:href="@{'/room/' + ${study.id} + '/board/' + ${postItem.id}}">
                        <span class="badge-notice">공지</span>
                        <span th:text="${postItem.title}">제목</span>
                    </a>
                </td>
                <td th:text="${postItem.writer.nickname}">작성자</td>
                <td th:text="${#temporals.format(postItem.createdAt, 'yyyy-MM-dd HH:mm')}">날짜</td>
            </tr>
            </tbody>
        </table>

        <!-- 일반 게시글 목록 -->
        <div class="section-title">게시글</div>
        <div th:if="${#lists.isEmpty(posts)}" class="empty">
            아직 작성된 게시글이 없습니다.
        </div>
        <table th:if="${!#lists.isEmpty(posts)}">
            <thead>
            <tr>
                <th>제목</th>
                <th>작성자</th>
                <th>작성일</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="postItem : ${posts}">
                <td>
                    <a th:href="@{'/room/' + ${study.id} + '/board/' + ${postItem.id}}">
                        <span th:if="${postItem.type.name() == 'NOTICE'}" class="badge-notice">공지</span>
                        <span th:text="${postItem.title}">제목</span>
                    </a>
                </td>
                <td th:text="${postItem.writer.nickname}">작성자</td>
                <td th:text="${#temporals.format(postItem.createdAt, 'yyyy-MM-dd HH:mm')}">날짜</td>
            </tr>
            </tbody>
        </table>

        <!-- 글쓰기 -->
        <div class="write-card">
            <div class="write-title">새 글 작성</div>
            <form th:action="@{'/room/' + ${study.id} + '/board/new'}"
                  method="post"
                  th:object="${postForm}">
                <div class="form-row">
                    <label for="title">제목</label>
                    <input id="title" type="text" th:field="*{title}" required>
                </div>

                <!-- 타입 선택: 누구나 보이지만 서버에서 권한 검증 -->
                <div class="form-row">
                    <label for="type">글 종류</label>
                    <select id="type" th:field="*{type}">
                        <option th:value="${T(com.studyhub.board.PostType).NORMAL}">일반</option>
                        <option th:value="${T(com.studyhub.board.PostType).NOTICE}">공지</option>
                    </select>
                </div>

                <div class="form-row">
                    <label for="content">내용</label>
                    <textarea id="content" th:field="*{content}" required></textarea>
                </div>

                <button type="submit" class="btn btn-primary">등록</button>
            </form>
        </div>

        <a th:href="@{'/room/' + ${study.id}}" class="back-link">← 스터디 홈으로 돌아가기</a>
    </section>
</main>
</body>
</html>

<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>알림 - StudyHub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- 전역 화이트 테마 -->
    <link rel="stylesheet" th:href="@{/css/studyhub.css}">

    <!-- 이 페이지 전용 스타일 -->
    <style>
        * { box-sizing: border-box; }

        .notif-main-wrapper {
            max-width: 960px;
            margin: 0 auto;
        }

        .description {
            margin-top: 4px;
            font-size: 14px;
            color: var(--color-text-muted);
        }

        .top-actions {
            margin-top: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            gap: 8px;
            flex-wrap: wrap;
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 12px;
            background-color: #fee2e2;
            color: #b91c1c;
        }

        .notification-list {
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification-card {
            border-radius: 12px;
            border: 1px solid var(--color-border-subtle);
            padding: 12px 14px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
            background-color: var(--color-surface);
        }

        .notification-card.unread {
            background-color: #eff6ff;
            border-color: #bfdbfe;
        }

        .notif-main {
            flex: 1;
        }

        .notif-message {
            margin: 0 0 4px 0;
            font-size: 14px;
            color: var(--color-text-main);
        }

        .notif-meta {
            font-size: 12px;
            color: var(--color-text-muted);
        }

        .notif-meta span + span::before {
            content: " · ";
            margin: 0 2px;
            color: var(--color-border-strong);
        }

        .notif-actions {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .small-btn {
            padding: 4px 8px;
            border-radius: 999px;
            border: none;
            font-size: 11px;
            cursor: pointer;
            white-space: nowrap;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: #ffffff;
        }

        .btn-light {
            background-color: #e5edff;
            color: #1d4ed8;
        }

        .empty {
            margin-top: 12px;
            font-size: 14px;
            color: var(--color-text-muted);
        }

        @media (max-width: 640px) {
            .top-actions {
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>

<!-- 사이트 공통 헤더 -->
<th:block th:replace="fragments/header :: header"></th:block>

<main class="page-container">
    <section class="card notif-main-wrapper">
        <h2 class="section-title">알림</h2>
        <p class="description">
            스터디 가입 승인/거절, 강퇴, 권한 변경 등 나와 관련된 알림들을 모아 보여줍니다.
        </p>

        <div class="top-actions">
            <div>
                <span th:if="${unreadCount > 0}" class="badge"
                      th:text="'읽지 않은 알림 ' + ${unreadCount} + '개'">읽지 않은 알림 0개</span>
                <span th:if="${unreadCount == 0}" style="font-size: 13px; color: var(--color-text-muted);">
                    읽지 않은 알림이 없습니다.
                </span>
            </div>
            <form th:if="${unreadCount > 0}" th:action="@{/notifications/read-all}" method="post" style="margin: 0;">
                <button type="submit" class="small-btn btn-light">모두 읽음 처리</button>
            </form>
        </div>

        <div class="notification-list">
            <div th:if="${#lists.isEmpty(notifications)}" class="empty">
                받은 알림이 아직 없습니다.
            </div>

            <div th:each="n : ${notifications}"
                 th:class="'notification-card ' + (!n.read ? 'unread' : '')">
                <div class="notif-main">
                    <p class="notif-message" th:text="${n.message}">알림 메시지</p>
                    <div class="notif-meta">
                        <span th:if="${n.study != null}"
                              th:text="'스터디: ' + ${n.study.title}">스터디 제목</span>
                        <span th:text="${#temporals.format(n.createdAt, 'yyyy-MM-dd HH:mm')}">
                            2025-12-03 20:00
                        </span>
                        <span th:if="${n.read}">이미 읽음</span>
                    </div>
                </div>
                <div class="notif-actions">
                    <form th:action="@{'/notifications/' + ${n.id} + '/read'}"
                          method="post"
                          style="margin: 0;">
                        <button type="submit"
                                class="small-btn btn-primary"
                                th:text="${n.linkUrl != null and !#strings.isEmpty(n.linkUrl)} ? '바로가기' : '읽음 처리'">
                            바로가기
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>
</main>

</body>
</html>

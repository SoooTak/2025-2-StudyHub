<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>알림 - StudyHub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fb;
        }

        header {
            background-color: #2b4cff;
            color: #ffffff;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .brand {
            font-size: 20px;
            font-weight: 600;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .link-btn,
        .link-button {
            display: inline-block;
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid #ffffff;
            background: transparent;
            color: #ffffff;
            font-size: 13px;
            text-decoration: none;
            cursor: pointer;
        }

        .link-btn.secondary {
            border-color: #d0dcff;
            background-color: #ffffff;
            color: #2b4cff;
        }

        .link-btn:hover,
        .link-button:hover {
            opacity: 0.9;
        }

        main {
            max-width: 960px;
            margin: 32px auto;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            padding: 22px 26px 26px;
        }

        h1 {
            margin: 0;
            font-size: 22px;
        }

        .description {
            margin-top: 4px;
            font-size: 14px;
            color: #666;
        }

        .top-actions {
            margin-top: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 12px;
            background-color: #ffe8e6;
            color: #a22024;
        }

        .notification-list {
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification-card {
            border-radius: 10px;
            border: 1px solid #e0e4f0;
            padding: 12px 14px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
            background-color: #ffffff;
        }

        .notification-card.unread {
            background-color: #f3f6ff;
            border-color: #c3d0ff;
        }

        .notif-main {
            flex: 1;
        }

        .notif-message {
            margin: 0 0 4px 0;
            font-size: 14px;
        }

        .notif-meta {
            font-size: 12px;
            color: #777;
        }

        .notif-actions {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .small-btn {
            padding: 4px 8px;
            border-radius: 999px;
            border: none;
            font-size: 11px;
            cursor: pointer;
        }

        .btn-primary {
            background-color: #2b4cff;
            color: #ffffff;
        }

        .btn-light {
            background-color: #edf0ff;
            color: #2b3b8f;
        }

        .empty {
            margin-top: 12px;
            font-size: 14px;
            color: #777;
        }

        @media (max-width: 640px) {
            main {
                margin: 0;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
<header>
    <div class="brand">
        <a href="/" style="color: #ffffff; text-decoration: none;">StudyHub</a>
    </div>
    <div class="nav-right">
        <a href="/studies" class="link-btn secondary">스터디 탐색</a>
        <a href="/my/studies" class="link-btn secondary">내 스터디</a>
        <a href="/notifications" class="link-btn">알림</a>

        <span th:if="${loggedIn}" th:text="${loginEmail} + ' 님'">user@example.com 님</span>
        <form th:if="${loggedIn}" th:action="@{/logout}" method="post" style="margin: 0;">
            <button type="submit" class="link-button">로그아웃</button>
        </form>
    </div>
</header>

<main>
    <h1>알림</h1>
    <p class="description">
        스터디 가입 승인/거절 등 나와 관련된 알림들을 모아 보여줍니다.
    </p>

    <div class="top-actions">
        <div>
            <span th:if="${unreadCount > 0}" class="badge"
                  th:text="'읽지 않은 알림 ' + ${unreadCount} + '개'">읽지 않은 알림 0개</span>
            <span th:if="${unreadCount == 0}" style="font-size: 13px; color: #777;">
                읽지 않은 알림이 없습니다.
            </span>
        </div>
        <form th:if="${unreadCount > 0}" th:action="@{/notifications/read-all}" method="post" style="margin: 0;">
            <button type="submit" class="small-btn btn-light">모두 읽음 처리</button>
        </form>
    </div>

    <div class="notification-list">
        <div th:if="${#lists.isEmpty(notifications)}" class="empty">
            받은 알림이 아직 없습니다.
        </div>

        <div th:each="n : ${notifications}"
             th:class="'notification-card ' + (!n.read ? 'unread' : '')">
            <div class="notif-main">
                <p class="notif-message" th:text="${n.message}">알림 메시지</p>
                <div class="notif-meta">
                    <span th:if="${n.study != null}"
                          th:text="'스터디: ' + ${n.study.title}">스터디 제목</span>
                    <span th:if="${n.study != null}"> · </span>
                    <span th:text="${n.createdAt}">2025-12-03T20:00</span>
                    <span th:if="${n.read}"> · 이미 읽음</span>
                </div>
            </div>
            <div class="notif-actions">
                <form th:action="@{'/notifications/' + ${n.id} + '/read'}" method="post" style="margin: 0;">
                    <button type="submit" class="small-btn btn-primary"
                            th:text="${n.linkUrl != null and !#strings.isEmpty(n.linkUrl)} ? '바로가기' : '읽음 처리'">
                        바로가기
                    </button>
                </form>
            </div>
        </div>
    </div>
</main>
</body>
</html>
